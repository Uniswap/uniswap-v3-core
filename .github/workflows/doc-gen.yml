name: Doc-gen

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  Doc-gen:
    name: Doc-gen
    runs-on: ubuntu-latest

    steps:
      - name: Check out Git repository
        uses: actions/checkout@v2

      - name: Set up node
        uses: actions/setup-node@v1
        with:
          node-version: 12

      - name: Install dependencies
        run: yarn install --frozen-lockfile

      - name: Generate docs from comments
        run: yarn solidity-docgen

      - name: Archive doc-gen artifacts
        uses: actions/upload-artifact@v2
        with:
          name: docs-directory
          path: |
            docs/

  deploy-wiki:
    name: deploy-wiki
    needs: Doc-gen
    runs-on: ubuntu-latest
    steps:
    - name: Download doc-gen results
      uses: actions/download-artifact@v2
      with:
        name: docs/

    - name: create-wiki
      uses: actions/checkout@v2

    - name: Push Wiki Changes
      uses: Andrew-Chen-Wang/github-wiki-action@v2
      env:
        # Make sure you have that / at the end. We use rsync 
        # WIKI_DIR's default is wiki/
        WIKI_DIR: docs/
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GH_MAIL: ${{ secrets.YOUR_EMAIL }}
        GH_NAME: ${{ github.repository_owner }}
        EXCLUDED_FILES: "a/ b.md"